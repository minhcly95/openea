<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>OpenEA: Bundle custom operators into a Plugin</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">OpenEA
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('tut5.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Bundle custom operators into a Plugin </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#tut5-plugins">Plugins</a></li>
<li class="level1"><a href="#tut5-rewriting">Rewriting custom classes</a><ul><li class="level2"><a href="#tut5-norm">Normalization</a></li>
<li class="level2"><a href="#tut5-var">Mutator and Recombinator</a></li>
<li class="level2"><a href="#tut5-init">Initializer</a></li>
<li class="level2"><a href="#tut5-eval">Evaluator</a></li>
<li class="level2"><a href="#tut5-plugin">Plugin</a></li>
</ul>
</li>
<li class="level1"><a href="#tut5-compile">Compile and Configure</a></li>
<li class="level1"><a href="#tut5-run">Run an EAML</a></li>
<li class="level1"><a href="#tut5-conclution">Conclusion</a></li>
<li class="level1"><a href="#tut5-optional">Appendix: Optional attributes</a></li>
</ul>
</div>
<div class="textblock"><p>This page describes the process how to create a plugin for the CLI from custom operators.</p>
<dl class="section user"><dt>Tutorial level</dt><dd>Intermediate</dd></dl>
<dl class="section user"><dt>Previous tutorial</dt><dd><a class="el" href="tut4.html">Write custom operators using the API</a></dd></dl>
<dl class="section user"><dt>Next tutorial</dt><dd><a class="el" href="tut6.html">Deploy an algorithm on a Cluster</a></dd></dl>
<h1><a class="anchor" id="tut5-plugins"></a>
Plugins</h1>
<p>As mentioned in <a class="el" href="tut2.html">Tutorial 2</a>, you can extent the framework by adding classes as add-ons so you can use them in the CLI. But the "add-on solution" can't help you if your classes depend on other libraries. And sometimes, your classes need special compiler options, or must be compiled with other toolset. Thankfully, plugins come to save the day. Plugins allow you to compile your files by yourself. In the end, you must provide a shared library and reconfigure the CLI so it can find and load your custom classes. Here, I describe the steps you need to do in order to create a plugin:</p><ol type="1">
<li>First, of course, you need to write your custom classes (which has been done in <a class="el" href="tut4.html">Tutorial 4</a>).</li>
<li>Then, use macros to register your classes into the <a class="el" href="classea_1_1_name_service.html" title="Static class which provides a service to translate class name into TypeInfo. ">NameService</a> automatically.</li>
<li>Next, write a special source file to aggregate all the classes needed to be added to the <a class="el" href="classea_1_1_name_service.html" title="Static class which provides a service to translate class name into TypeInfo. ">NameService</a>.</li>
<li>Compile your classes to produce a shared library.</li>
<li>Finally, reconfigure the CLI so it can find and load your newly created shared library.</li>
</ol>
<h1><a class="anchor" id="tut5-rewriting"></a>
Rewriting custom classes</h1>
<p>First thing we need to do is to split the code in <a class="el" href="tut4.html">Tutorial 4</a> into multiple files. You can find the full source listing here:</p>
<ul>
<li><a class="el" href="_sphere_opt_vector_8h.html">SphereOptVector.h</a></li>
<li><a class="el" href="_sphere_opt_vector_8cpp.html">SphereOptVector.cpp</a></li>
<li><a class="el" href="_sphere_mutation_8h.html">SphereMutation.h</a></li>
<li><a class="el" href="_sphere_mutation_8cpp.html">SphereMutation.cpp</a></li>
<li><a class="el" href="_sphere_crossover_8h.html">SphereCrossover.h</a></li>
<li><a class="el" href="_sphere_crossover_8cpp.html">SphereCrossover.cpp</a></li>
<li><a class="el" href="_sphere_initializer_8h.html">SphereInitializer.h</a></li>
<li><a class="el" href="_sphere_initializer_8cpp.html">SphereInitializer.cpp</a></li>
<li><a class="el" href="_sphere_opt_evaluator_8h.html">SphereOptEvaluator.h</a></li>
<li><a class="el" href="_sphere_opt_evaluator_8cpp.html">SphereOptEvaluator.cpp</a></li>
<li><a class="el" href="_sphere_opt_plugin_8cpp.html">SphereOptPlugin.cpp</a></li>
</ul>
<dl class="section note"><dt>Note</dt><dd>The line <code>#ifndef DOXYGEN_IGNORE</code> and <code>#endif</code> are used to ignore these classes in documentation generating process. You can omit them in your implementation.</dd></dl>
<h2><a class="anchor" id="tut5-norm"></a>
Normalization</h2>
<p>First, we will transform the normalization function into a static function of a class named <code>SphereOptVector</code>. This step is not very neccessary, you can use old-style C global function instead of static function, but I just want to make it consistent. Here is the function declaration part in <a class="el" href="_sphere_opt_vector_8h.html">SphereOptVector.h</a> :</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>SphereOptVector {</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> Normalize(vector&lt;double&gt;&amp; x);</div><div class="line">};</div></div><!-- fragment --> <dl class="section note"><dt>Note</dt><dd>In this tutorial, I will only show the class declaration part of the header files. The implementation of those classes in the source file is nearly identical to which in <a class="el" href="tut4.html">Tutorial 4</a>. You can consult the source listing given above for the specific implementation.</dd></dl>
<h2><a class="anchor" id="tut5-var"></a>
Mutator and Recombinator</h2>
<p>Next, we will split the <code>SphereMutation</code> and <code>SphereCrossover</code> class into their own header and source files:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>SphereMutation: <span class="keyword">public</span> TypedMutator&lt;DoubleArrayGenome&gt; {</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <a class="code" href="_constructible_8h.html#a69c6338b567c9b319dae8f5fdf94acb9">EA_TYPEINFO_DEFAULT</a>(SphereMutation)</div><div class="line"></div><div class="line">protected:</div><div class="line">    virtual <a class="code" href="namespaceea.html#a28f6c7da694dbd57413b188e0fb3cb33">DoubleArrayGenomePtr</a> DoApply(const <a class="code" href="namespaceea.html#a28f6c7da694dbd57413b188e0fb3cb33">DoubleArrayGenomePtr</a>&amp; pTarget) override;</div><div class="line">};</div><div class="line"></div><div class="line"><a class="code" href="_plugin_8h.html#a1d7d54d1612a8053e6f3e23c0b9ffc53">REGISTER_ADDON</a>(SphereMutation)</div></div><!-- fragment --> <div class="fragment"><div class="line"><span class="keyword">class </span>SphereCrossover: <span class="keyword">public</span> TypedRecombinator&lt;DoubleArrayGenome&gt; {</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <a class="code" href="_constructible_8h.html#a69c6338b567c9b319dae8f5fdf94acb9">EA_TYPEINFO_DEFAULT</a>(SphereCrossover)</div><div class="line"></div><div class="line">protected:</div><div class="line">    virtual <a class="code" href="namespaceea.html#a28f6c7da694dbd57413b188e0fb3cb33">DoubleArrayGenomePtr</a> DoCombine(vector&lt;<a class="code" href="namespaceea.html#a28f6c7da694dbd57413b188e0fb3cb33">DoubleArrayGenomePtr</a>&gt;&amp; pParents) override;</div><div class="line">    virtual <a class="code" href="namespaceea.html#ae7e199d72692a6905f583e4623d91b92">uint</a> GetParentCount() override;</div><div class="line">};</div><div class="line"></div><div class="line"><a class="code" href="_plugin_8h.html#a1d7d54d1612a8053e6f3e23c0b9ffc53">REGISTER_ADDON</a>(SphereCrossover)</div></div><!-- fragment --><p> Besides defining the classes, we also add two macros mentioned in <a class="el" href="tut2.html">Tutorial 2</a>. Here is a little recap:</p>
<blockquote class="doxtable">
<p>The first macro is <a class="el" href="_constructible_8h.html#a69c6338b567c9b319dae8f5fdf94acb9">EA_TYPEINFO_DEFAULT</a> which define the type information (<a class="el" href="classea_1_1_type_info.html" title="Data structure containing class information. ">TypeInfo</a>) of your custom type. This <a class="el" href="classea_1_1_type_info.html" title="Data structure containing class information. ">TypeInfo</a> contains the EAML Name, the attributes of your class and how to construct it from an EAML configuration file. The second macro is <a class="el" href="_plugin_8h.html#a1d7d54d1612a8053e6f3e23c0b9ffc53">REGISTER_ADDON</a> which will add the defined-above <a class="el" href="classea_1_1_type_info.html" title="Data structure containing class information. ">TypeInfo</a> to the <a class="el" href="classea_1_1_name_service.html" title="Static class which provides a service to translate class name into TypeInfo. ">NameService</a>. If your class is not added to the <a class="el" href="classea_1_1_name_service.html" title="Static class which provides a service to translate class name into TypeInfo. ">NameService</a> by using this macro, the CLI has no way to know what is the EAML name of your custom class. </p>
</blockquote>
<p>You also notice, in <a class="el" href="_sphere_opt_vector_8h.html">SphereOptVector.h</a> we don't have such macro. The reason is simple: you only need to use these macros for classes which are built from an EAML file. If a class is used internally only, you don't need to define anything.</p>
<h2><a class="anchor" id="tut5-init"></a>
Initializer</h2>
<p>The class <code>SphereInitializer</code> needs some attention. If we look into its declaration:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>SphereInitializer: <span class="keyword">public</span> Initializer {</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <a class="code" href="_constructible_8h.html#ac664751136bcc8e1f038dc8e60d141b9">EA_TYPEINFO_CUSTOM_DECL</a></div><div class="line"></div><div class="line">    SphereInitializer(<a class="code" href="namespaceea.html#ae7e199d72692a6905f583e4623d91b92">uint</a> pLength);</div><div class="line"></div><div class="line"><span class="keyword">protected</span>:</div><div class="line">    <span class="keyword">virtual</span> <a class="code" href="namespaceea.html#a38644d5f803b70178921a14584bde13b">GenomePoolPtr</a> DoInitialize(<a class="code" href="namespaceea.html#ae7e199d72692a6905f583e4623d91b92">uint</a> pSize) <span class="keyword">override</span>;</div><div class="line"></div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <a class="code" href="namespaceea.html#ae7e199d72692a6905f583e4623d91b92">uint</a> mLength;</div><div class="line">};</div><div class="line"></div><div class="line"><a class="code" href="_plugin_8h.html#a1d7d54d1612a8053e6f3e23c0b9ffc53">REGISTER_ADDON</a>(SphereInitializer)</div></div><!-- fragment --><p> We will notice that its contructor requires a parameter (the initial pool size). We cannot construct a <code>SphereInitializer</code> without this parameter. <a class="el" href="_constructible_8h.html#a69c6338b567c9b319dae8f5fdf94acb9">EA_TYPEINFO_DEFAULT</a> isn't suitable for this class, because it construct the class using the default constructor. Therefore we must define a custom <a class="el" href="classea_1_1_type_info.html" title="Data structure containing class information. ">TypeInfo</a> by first use the macro <a class="el" href="_constructible_8h.html#ac664751136bcc8e1f038dc8e60d141b9">EA_TYPEINFO_CUSTOM_DECL</a> to declare that we will write a custom one. Then in the source file (<a class="el" href="_sphere_initializer_8cpp.html">SphereInitializer.cpp</a>), we have this segment of code:</p>
<div class="fragment"><div class="line"><a class="code" href="_constructible_8h.html#a856ad6dc0367e41ded977fdf2a0476ec">EA_TYPEINFO_CUSTOM_IMPL</a>(SphereInitializer) {</div><div class="line">    <span class="keywordflow">return</span> *<a class="code" href="classea_1_1_type_info.html">ea::TypeInfo</a>(<span class="stringliteral">&quot;SphereInitializer&quot;</span>).</div><div class="line">            SetConstructor&lt;SphereInitializer, uint&gt;(<span class="stringliteral">&quot;length&quot;</span>);</div><div class="line">}</div></div><!-- fragment --><p> The first line using the macro</p>
 <div class="fragment"><div class="line"><a class="code" href="_constructible_8h.html#a856ad6dc0367e41ded977fdf2a0476ec">EA_TYPEINFO_CUSTOM_IMPL</a>(SphereInitializer) {</div></div><!-- fragment --></p>
<p>to start implement the <a class="el" href="classea_1_1_type_info.html" title="Data structure containing class information. ">TypeInfo</a>. If you have declared a <a class="el" href="classea_1_1_type_info.html" title="Data structure containing class information. ">TypeInfo</a> using <a class="el" href="_constructible_8h.html#ac664751136bcc8e1f038dc8e60d141b9">EA_TYPEINFO_CUSTOM_DECL</a>, you must have a <a class="el" href="_constructible_8h.html#a856ad6dc0367e41ded977fdf2a0476ec">EA_TYPEINFO_CUSTOM_IMPL</a> of the same class somewhere in your code. Then, we define the EAML Name of the class using <a class="el" href="classea_1_1_type_info.html" title="Data structure containing class information. ">TypeInfo</a> constructor:</p>
<p><div class="fragment"><div class="line">    <span class="keywordflow">return</span> *<a class="code" href="classea_1_1_type_info.html">ea::TypeInfo</a>(<span class="stringliteral">&quot;SphereInitializer&quot;</span>).</div></div><!-- fragment --></p>
<dl class="section note"><dt>Note</dt><dd>Defining custom <a class="el" href="classea_1_1_type_info.html" title="Data structure containing class information. ">TypeInfo</a> allows you to give a different EAML Name to a class by changing the string in the <a class="el" href="classea_1_1_type_info.html" title="Data structure containing class information. ">TypeInfo</a> constructor. You can not do this when using <a class="el" href="_constructible_8h.html#a69c6338b567c9b319dae8f5fdf94acb9">EA_TYPEINFO_DEFAULT</a>.</dd></dl>
<p>Finally, assign the signature of the constructor that you want to use:</p>
<p><div class="fragment"><div class="line">            SetConstructor&lt;SphereInitializer, uint&gt;(<span class="stringliteral">&quot;length&quot;</span>);</div></div><!-- fragment --></p>
<p>In this example, it will use the constructor of class <code>SphereInitializer</code> with a parameter of type <code>uint</code>. This parameter has an EAML attribute name of <code>"length"</code>. You can only set only one signature for the constructor. Every attribute name existing in this signature is required.</p>
<dl class="section note"><dt>Note</dt><dd>See <a class="el" href="tut5.html#tut5-optional">Appendix: Optional attributes</a> to know how to make the attribute <code>"length"</code> optional.</dd></dl>
<h2><a class="anchor" id="tut5-eval"></a>
Evaluator</h2>
<p>Before we can package our classes into a plugin, we still need to write an <a class="el" href="classea_1_1_evaluator.html" title="The interface for evaluation method. ">Evaluator</a> for our problem. The process of writing an <a class="el" href="classea_1_1_evaluator.html" title="The interface for evaluation method. ">Evaluator</a> is identical to which described in <a class="el" href="tut2.html">Tutorial 2</a>. Here is the code of the <a class="el" href="classea_1_1_evaluator.html" title="The interface for evaluation method. ">Evaluator</a>:</p>
<p><a class="el" href="_sphere_opt_evaluator_8h.html">SphereOptEvaluator.h</a></p>
<div class="fragment"><div class="line"><span class="keyword">class </span>SphereOptEvaluator: <span class="keyword">public</span> TypedScalarEvaluator&lt;DoubleArrayGenome&gt; {</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <a class="code" href="_constructible_8h.html#a69c6338b567c9b319dae8f5fdf94acb9">EA_TYPEINFO_DEFAULT</a>(SphereOptEvaluator)</div><div class="line"></div><div class="line">protected:</div><div class="line">    virtual <span class="keywordtype">double</span> DoScalarEvaluate(const <a class="code" href="namespaceea.html#a28f6c7da694dbd57413b188e0fb3cb33">DoubleArrayGenomePtr</a>&amp; pGenome) override;</div><div class="line">};</div><div class="line"></div><div class="line"><a class="code" href="_plugin_8h.html#a1d7d54d1612a8053e6f3e23c0b9ffc53">REGISTER_ADDON</a>(SphereOptEvaluator)</div></div><!-- fragment --><p> <a class="el" href="_sphere_opt_evaluator_8cpp.html">SphereOptEvaluator.cpp</a></p>
<div class="fragment"><div class="line"><span class="keywordtype">double</span> SphereOptEvaluator::DoScalarEvaluate(<span class="keyword">const</span> <a class="code" href="namespaceea.html#a28f6c7da694dbd57413b188e0fb3cb33">DoubleArrayGenomePtr</a>&amp; pGenome) {</div><div class="line">    vector&lt;double&gt;&amp; x = pGenome-&gt;GetGenes();</div><div class="line">    <a class="code" href="namespaceea.html#ae7e199d72692a6905f583e4623d91b92">uint</a> n = x.size();</div><div class="line">    <span class="keywordflow">return</span> <a class="codeRef" doxygen="/home/minh/repo/vgu_interns/EA/doc/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/algorithm/accumulate.html">std::accumulate</a>(x.begin(), x.end(), <a class="codeRef" doxygen="/home/minh/repo/vgu_interns/EA/doc/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/numeric/math/pow.html">pow</a>(n, n / 2.0), <a class="codeRef" doxygen="/home/minh/repo/vgu_interns/EA/doc/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/utility/functional/multiplies.html">std::multiplies&lt;double&gt;</a>());</div><div class="line">}</div></div><!-- fragment --> <h2><a class="anchor" id="tut5-plugin"></a>
Plugin</h2>
<p>To create a plugin, it is required to have another source file to aggregate all the classes needed to be registered in the <a class="el" href="classea_1_1_name_service.html" title="Static class which provides a service to translate class name into TypeInfo. ">NameService</a>.</p>
<p><a class="el" href="_sphere_opt_plugin_8cpp.html">SphereOptPlugin.cpp</a></p>
<div class="fragment"><div class="line"><span class="preprocessor">#define EA_PLUGIN_MAIN_SOURCE</span></div><div class="line"><span class="preprocessor">#include &lt;openea/EA/Plugin.h&gt;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="_sphere_crossover_8h.html">SphereCrossover.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="_sphere_mutation_8h.html">SphereMutation.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="_sphere_initializer_8h.html">SphereInitializer.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="_sphere_opt_evaluator_8h.html">SphereOptEvaluator.h</a>&quot;</span></div></div><!-- fragment --><p>The source file must define <code><b>EA_PLUGIN_MAIN_SOURCE</b></code> and include the <code>&lt;openea/EA/Plugin.h&gt;</code> header file. Besides that, it must also include all the header files containing <a class="el" href="_plugin_8h.html#a1d7d54d1612a8053e6f3e23c0b9ffc53">REGISTER_ADDON</a> macro (directly or indirectly). Notice the order of these preprocessors, it is important. The macro definition must come first, then the <code><a class="el" href="_plugin_8h.html">Plugin.h</a></code> header, then other header files. At this point, we are ready to compile our plugin.</p>
<dl class="section note"><dt>Note</dt><dd>You may notice that <a class="el" href="_sphere_opt_vector_8h.html">SphereOptVector.h</a> is not included because <code>SphereOptVector</code> doesn't need to be registered to the <a class="el" href="classea_1_1_name_service.html" title="Static class which provides a service to translate class name into TypeInfo. ">NameService</a>.</dd></dl>
<h1><a class="anchor" id="tut5-compile"></a>
Compile and Configure</h1>
<p>You can compile a plugin just like any shared library. Remember to link to the <code>openea</code> library. Here I create a <code>Makefile</code> to make things more organized:</p>
<div class="fragment"><div class="line">CPP := $(shell find . -name &quot;*.cpp&quot;)</div><div class="line"></div><div class="line">all: libopenea_SO.so</div><div class="line"></div><div class="line">libopenea_SO.so: $(CPP)</div><div class="line">    g++ -std=c++14 -shared -fPIC -O3 -o libopenea_SO.so $(CPP) -lopenea</div><div class="line"></div><div class="line">clean:</div><div class="line">    rm -f libopenea_SO.so</div></div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>It is not required to have the library name with the prefix of <code>libopenea</code>. This file name is just for demonstration purpose.</dd></dl>
<p>Then invoke this <code>Makefile</code> to compile our plugin by using this command:</p>
<div class="fragment"><div class="line">make all</div></div><!-- fragment --><p>A file <code><b>libopenea_SO.so</b></code> will be generated. The next step is to configure the CLI so it can find your newly compiled library. First you need to know the absolute path of your library. You could enter this command to print out the path:</p>
<div class="fragment"><div class="line">realpath libopenea_SO.so</div></div><!-- fragment --><p>Then, you need to copy this path into the <code><b>plugin.conf</b></code> file. If you don't know where this file resides in your system, use this command to edit the file directly in your favorite editor:</p>
<div class="fragment"><div class="line">openea edit plugin</div></div><!-- fragment --><p>Paste the path of your library there, save it and done, you have finished the reconfiguration procedure. You don't need to recompile anything, your library will be loaded dynamically when an EA starts (that's the power of this framework, compilation is kept to a minimum).</p>
<dl class="section note"><dt>Note</dt><dd>You can have multiple plugins configured by having multiple lines in the <code>plugin.conf</code> file, each line for a plugin.</dd></dl>
<h1><a class="anchor" id="tut5-run"></a>
Run an EAML</h1>
<p>Before we end this tutorial, we need to make sure that our plugin works. First, create an EAML file (named <code>SphereOpt.eaml</code> in this case):</p>
<div class="fragment"><div class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</div><div class="line">&lt;EvolutionStrategy size=&quot;100&quot;&gt;</div><div class="line">    </div><div class="line">    &lt;initializer&gt;</div><div class="line">        &lt;SphereInitializer length=&quot;25&quot;/&gt;</div><div class="line">    &lt;/initializer&gt;</div><div class="line">    </div><div class="line">    &lt;recombinators&gt;</div><div class="line">        &lt;MetaRecombinator ratio=&quot;1&quot;&gt;</div><div class="line">            &lt;recombinator&gt;</div><div class="line">                &lt;SphereCrossover/&gt;</div><div class="line">            &lt;/recombinator&gt;</div><div class="line">            &lt;selector&gt;</div><div class="line">                &lt;UniformSelection/&gt;</div><div class="line">            &lt;/selector&gt;</div><div class="line">        &lt;/MetaRecombinator&gt;</div><div class="line">    &lt;/recombinators&gt;</div><div class="line">    </div><div class="line">    &lt;mutators&gt;</div><div class="line">        &lt;MetaMutator rate=&quot;0.1&quot;&gt;</div><div class="line">            &lt;mutator&gt;</div><div class="line">                &lt;SphereMutation/&gt;</div><div class="line">            &lt;/mutator&gt;</div><div class="line">        &lt;/MetaMutator&gt;</div><div class="line">    &lt;/mutators&gt;</div><div class="line">    </div><div class="line">    &lt;survival-selector&gt;</div><div class="line">        &lt;TournamentSelection size=&quot;5&quot;/&gt;</div><div class="line">    &lt;/survival-selector&gt;</div><div class="line">    </div><div class="line">    &lt;evaluator&gt;</div><div class="line">        &lt;SphereOptEvaluator/&gt;</div><div class="line">    &lt;/evaluator&gt;</div><div class="line">    </div><div class="line">    &lt;hooks&gt;</div><div class="line">        &lt;StandardOutputHook/&gt;</div><div class="line">        &lt;GenerationTerminationHook target=&quot;10000&quot;/&gt;</div><div class="line">    &lt;/hooks&gt;</div><div class="line">    </div><div class="line">&lt;/EvolutionStrategy&gt;</div></div><!-- fragment --><p>Then run it using the CLI toolset:</p>
<div class="fragment"><div class="line">openea run SphereOpt.eaml</div></div><!-- fragment --><p>And it should produce an output like this:</p>
<div class="fragment"><div class="line">[2017-06-28 14:13:15.628281] PluginLoader: Loaded 1 plugin(s).</div><div class="line">[2017-06-28 14:13:15.628332] CLI: Reading SphereOpt.eaml</div><div class="line">[2017-06-28 14:13:15.628636] CLI: <span class="stringliteral">&quot;EvolutionStrategy&quot;</span> reconstructed</div><div class="line">[2017-06-28 14:13:15.628683] CLI: BackupHook not found. Default one added to folder <span class="stringliteral">&quot;~/.openea/.backup&quot;</span>.</div><div class="line">[2017-06-28 14:13:15.634487] Parallel processing is enabled, number of threads = 4</div><div class="line">[2017-06-28 14:13:15.646656] <a class="code" href="classea_1_1_backup_hook.html#abb170210410b287564c5f7bc4c340bad">BackupHook::DoInitial</a>: Cleared 1 file(s) in &quot;~/.openea/.backup&quot;.</div><div class="line">[2017-06-28 14:13:15.646695] Population initialized, evaluation 100</div><div class="line">[2017-06-28 14:13:15.646717] Evolution started from generation 0, evaluation 100</div><div class="line">Gen       1 Best =   0.100655   0.1148-0.1045-0.2212-0.1954-0.1574-0.1842-0.0792-0.2021-0.2264- ...</div><div class="line">Gen       2 Best =   0.302582   0.2032-0.2280-0.2346-0.1565-0.1303-0.1177-0.2196-0.2020-0.1301- ...</div><div class="line">Gen       3 Best =   0.453406   0.2286-0.2101-0.1743-0.1655-0.2069-0.2666-0.1505-0.2261-0.2603- ...</div><div class="line">...</div><div class="line">Gen   9,998 Best =   0.999993   0.1998-0.2001-0.1998-0.1999-0.2002-0.2000-0.2001-0.2000-0.2001- ...</div><div class="line">Gen   9,999 Best =   0.999993   0.1998-0.2001-0.1998-0.1999-0.2002-0.2000-0.2001-0.2000-0.2001- ...</div><div class="line">Gen  10,000 Best =   0.999993   0.1998-0.2001-0.1998-0.1999-0.2002-0.2000-0.2001-0.2000-0.2001- ...</div><div class="line">[2017-06-28 14:13:22.041399] GenerationTerminationHook: Reached generation <span class="preprocessor">#10000 &gt;= 10000. Terminating...</span></div><div class="line">[2017-06-28 14:13:22.041870] BackupHook: Backup saved to <span class="stringliteral">&quot;~/.openea/.backup/010000.eabak&quot;</span>.</div><div class="line">[2017-06-28 14:13:22.041905] Evolution stopped at generation 10000, evaluation 1000100</div><div class="line">[2017-06-28 14:13:22.041927] Time Report: [S] 0.138166 [M] 0.0820524 [E] 0.115055 [F] 0.0919763 [Total] 0.486242 ms</div></div><!-- fragment --><p>You should notice now, in the first output line, we have now 1 plugin loaded. If you have an error like this:</p>
<div class="fragment"><div class="line">PluginLoader: Loaded 0 plugin(s).</div><div class="line">...</div><div class="line">Fatal Error: ../src/rtoc/NameService.cpp:41 : CLASS_NAME_NOT_EXIST - SphereInitializer <span class="keyword">class </span>does not exist in Name service.</div></div><!-- fragment --><p>Please make sure the path of your library is correct and the library exists.</p>
<h1><a class="anchor" id="tut5-conclution"></a>
Conclusion</h1>
<p>This tutorial has shown you how to package your custom classes into a plugin for CLI toolset. With your plugin up and running, you can use any CLI options mentioned in <a class="el" href="tut3.html">Tutorial 3</a> to add more features and control your algorithm. Here is the summary of the process of creating a plugin:</p>
<ul>
<li>Write your custom classes.</li>
<li>Use macros to define <a class="el" href="classea_1_1_type_info.html" title="Data structure containing class information. ">TypeInfo</a> and register it to the <a class="el" href="classea_1_1_name_service.html" title="Static class which provides a service to translate class name into TypeInfo. ">NameService</a>. Define custom <a class="el" href="classea_1_1_type_info.html" title="Data structure containing class information. ">TypeInfo</a> if needed.</li>
<li>Write a source file aggregates all the classes needed to be added to the <a class="el" href="classea_1_1_name_service.html" title="Static class which provides a service to translate class name into TypeInfo. ">NameService</a>.</li>
<li>Compile the plugin in the form of a shared library.</li>
<li>Configure the CLI by copy the path of the library into <code>plugin.conf</code>.</li>
</ul>
<p>The next tutorial will introduce a new CLI feature which is distributed computation on cluster:</p>
<p><a class="el" href="tut6.html">Deploy an algorithm on a Cluster</a></p>
<h1><a class="anchor" id="tut5-optional"></a>
Appendix: Optional attributes</h1>
<p>In this tutorial, the class <code>SphereInitializer</code> has a required attribute named <code>"length"</code>. If you want to make this attribute optional, you need some little adjustments of the code. First, the class constructor must have a signature excluding the optional attribute. For example, we can edit the <a class="el" href="_sphere_initializer_8h.html">SphereInitializer.h</a> as follow:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>SphereInitializer: <span class="keyword">public</span> Initializer {</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <a class="code" href="_constructible_8h.html#ac664751136bcc8e1f038dc8e60d141b9">EA_TYPEINFO_CUSTOM_DECL</a></div><div class="line"></div><div class="line">    SphereInitializer(<a class="code" href="namespaceea.html#ae7e199d72692a6905f583e4623d91b92">uint</a> pLength = 25);</div><div class="line"></div><div class="line"><span class="keyword">protected</span>:</div><div class="line">    <span class="keyword">virtual</span> <a class="code" href="namespaceea.html#a38644d5f803b70178921a14584bde13b">GenomePoolPtr</a> DoInitialize(<a class="code" href="namespaceea.html#ae7e199d72692a6905f583e4623d91b92">uint</a> pSize) <span class="keyword">override</span>;</div><div class="line"></div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <a class="code" href="namespaceea.html#ae7e199d72692a6905f583e4623d91b92">uint</a> mLength;</div><div class="line">};</div><div class="line"></div><div class="line"><a class="code" href="_plugin_8h.html#a1d7d54d1612a8053e6f3e23c0b9ffc53">REGISTER_ADDON</a>(SphereInitializer)</div></div><!-- fragment --><p>Now, the class has two signatures for the constructor, one of them requires no parameter. Then, edit the <a class="el" href="classea_1_1_type_info.html" title="Data structure containing class information. ">TypeInfo</a> definition as follow:</p>
<div class="fragment"><div class="line"><a class="code" href="_constructible_8h.html#a856ad6dc0367e41ded977fdf2a0476ec">EA_TYPEINFO_CUSTOM_IMPL</a>(SphereInitializer) {</div><div class="line">    <span class="keywordflow">return</span> *<a class="code" href="classea_1_1_type_info.html">ea::TypeInfo</a>(<span class="stringliteral">&quot;SphereInitializer&quot;</span>).</div><div class="line">            Add(<span class="stringliteral">&quot;length&quot;</span>, &amp;SphereInitializer::mLength)-&gt;</div><div class="line">            SetConstructor&lt;SphereInitializer&gt;();</div><div class="line">}</div></div><!-- fragment --><p>There are two modifications. First in <code>SetConstructor()</code>, we removed the parameter, so it will construct the object using the contructor with no parameter and <code>"length"</code> is not required. Then, we need to add the <code>"length"</code> attribute separately using <code>TypeInfo::Add()</code>. In this case, we bind the <code>"length"</code> attribute to the field <code>SphereInitializer::mLength</code> using member pointer. You don't need to understand what member pointer is, just use this pattern where you need.</p>
<p>To test our modification, recompile the plugin, remove the <code>"length"</code> attribute of <code>&lt;SphereInitializer&gt;</code> tag in the EAML file and the program should run like normal.</p>
<dl class="section note"><dt>Note</dt><dd>Only the first line of <a class="el" href="classea_1_1_type_info.html" title="Data structure containing class information. ">TypeInfo</a> definition uses dot, from the second line, an arrow is used instead. The reason is that the TypeInfo::Add() returns a pointer of <a class="el" href="classea_1_1_type_info.html" title="Data structure containing class information. ">TypeInfo</a> for cascaded calls while calling its constructor creates a value object. </dd></dl>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="tutorials.html">Tutorials</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
